import streamlit as st
import numpy as np
import pandas as pd
import datetime
import time

st.write('''
    # Streamlitç¼“å­˜æŠ€æœ¯
    Streamlitæä¾›äº†ä¸€ç§ç¼“å­˜æœºåˆ¶ï¼Œå³ä½¿åœ¨ä»WebåŠ è½½æ•°æ®ï¼Œå¤„ç†å¤§å‹æ•°æ®é›†æˆ–æ‰§è¡Œæ˜‚è´µçš„è®¡ç®—æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿æ‚¨çš„åº”ç”¨ç¨‹åºä¿æŒé«˜æ€§èƒ½ã€‚è¿™æ˜¯é€šè¿‡@st.cacheè£…é¥°å™¨å®Œæˆçš„ã€‚
    å½“ç”¨@st.cacheè£…é¥°å™¨æ ‡è®°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå®ƒå‘Šè¯‰Streamlitæ¯å½“è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå®ƒéƒ½éœ€è¦æ£€æŸ¥ä¸€äº›äº‹æƒ…ï¼š
    * å‡½æ•°åç§°
    * ç»„æˆå‡½æ•°ä¸»ä½“çš„å®é™…ä»£ç 
    * ç”¨æ¥è°ƒç”¨å‡½æ•°çš„è¾“å…¥å‚æ•°
        * streamlitçš„ç¼“å­˜æœºåˆ¶æ˜¯é€šè¿‡@st.cacheçš„è£…é¥°å™¨å®ç°çš„ã€‚
        * æ¯å½“ç¨‹åºè¿è¡Œè‡³è¢«cacheè£…é¥°çš„å‡½æ•°æ—¶ï¼Œå½“ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œä¼šæ­£å¸¸æ‰§è¡Œå¹¶å°†ç»“æœå­˜å…¥ç¼“å­˜ï¼Œ
        * å½“å‡½æ•°è¢«å†æ¬¡è¿è¡Œï¼Œé¦–å…ˆä¼šåˆ¤æ–­å‡½æ•°çš„è¾“å…¥å‚æ•°ï¼Œå‡½æ•°ä¸»ä½“å†…å®¹æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œåˆ™é‡æ–°è¿è¡Œå‡½æ•°ï¼Œå¦åˆ™å°†è·³è¿‡å‡½æ•°ï¼Œç›´æ¥è¯»å–ç¼“å­˜ç»“æœã€‚
    * ä¸»è¦é™åˆ¶æ˜¯**Streamlitçš„ç¼“å­˜åŠŸèƒ½ä¸çŸ¥é“åœ¨å¸¦æ³¨é‡Šçš„å‡½æ•°ä¸»ä½“ä¹‹å¤–å‘ç”Ÿçš„æ›´æ”¹** 

    ```python
    streamlit.cache(
        func=None, 
        persist=False, 
        allow_output_mutation=False, 
        show_spinner=True, 
        suppress_st_warning=False, 
        hash_funcs=None, 
        max_entries=None, 
        ttl=None
    )
    ```

    ```
    å‡½æ•°è£…é¥°å™¨ï¼Œç”¨äºè®°å¿†å‡½æ•°æ‰§è¡Œã€‚
    
    å‚æ•°ï¼š	
    
    funcï¼ˆcallableï¼‰â€“ç¼“å­˜åŠŸèƒ½ã€‚Streamlitå¯¹å‡½æ•°å’Œç›¸å…³ä»£ç è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚
    
    persistï¼ˆbooleanï¼‰â€“æ˜¯å¦å°†ç¼“å­˜ä¿ç•™åœ¨ç£ç›˜ä¸Šã€‚
    
    allow_output_mutationï¼ˆbooleanï¼‰â€“
    å½“è¿”å›å€¼æœªçªå˜æ—¶ï¼ŒStreamlité€šå¸¸ä¼šæ˜¾ç¤ºè­¦å‘Šï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„åæœã€‚è¿™æ˜¯é€šè¿‡å†…éƒ¨å¯¹è¿”å›å€¼è¿›è¡Œå“ˆå¸Œå¤„ç†æ¥å®Œæˆçš„ã€‚å¦‚æœæ‚¨çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå¹¶ä¸”æƒ³è¦è¦†ç›–æ­¤è­¦å‘Šï¼Œè¯·å°†å…¶è®¾ç½®ä¸ºTrueã€‚

    show_spinnerï¼ˆbooleanï¼‰â€“å¯ç”¨å¾®è°ƒå™¨ã€‚é»˜è®¤å€¼ä¸ºTrueï¼Œä»¥åœ¨å‘ç”Ÿé«˜é€Ÿç¼“å­˜æœªå‘½ä¸­æ—¶æ˜¾ç¤ºå¾®è°ƒæ¡†ã€‚
    
    suppress_st_warningï¼ˆbooleanï¼‰â€“ç¦æ­¢æœ‰å…³ä»ç¼“å­˜çš„å‡½æ•°å†…è°ƒç”¨Streamlitå‡½æ•°çš„è­¦å‘Šã€‚
    
    hash_funcsï¼ˆdict æˆ–Noneï¼‰â€“ç±»å‹æˆ–å®Œå…¨é™å®šåç§°åˆ°å“ˆå¸Œå‡½æ•°çš„æ˜ å°„ã€‚è¿™ç”¨äºè¦†ç›–Streamlitçš„ç¼“å­˜æœºåˆ¶ä¸­å“ˆå¸Œå™¨çš„è¡Œä¸ºï¼šå½“å“ˆå¸Œå™¨é‡åˆ°å¯¹è±¡æ—¶ï¼Œå®ƒå°†é¦–å…ˆæ£€æŸ¥å…¶ç±»å‹æ˜¯å¦ä¸æ­¤å­—å…¸ä¸­çš„é”®åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™ä½¿ç”¨æä¾›çš„å‡½æ•°æ¥ç”Ÿæˆå“ˆå¸Œã€‚æœ‰å…³å¦‚ä½•ä½¿ç”¨æ­¤åŠŸèƒ½çš„ç¤ºä¾‹ï¼Œè¯·å‚è§ä¸‹æ–‡ã€‚
    
    max_entriesï¼ˆint æˆ–Noneï¼‰â€“ä¿ç•™åœ¨ç¼“å­˜ä¸­çš„æœ€å¤§æ¡ç›®æ•°ï¼Œæˆ–æ— é™åˆ¶çš„ç¼“å­˜çš„Noneã€‚ï¼ˆå°†æ–°æ¡ç›®æ·»åŠ åˆ°å®Œæ•´ç¼“å­˜åï¼Œæœ€æ—©çš„ç¼“å­˜æ¡ç›®å°†è¢«åˆ é™¤ã€‚ï¼‰é»˜è®¤å€¼ä¸ºâ€œæ— â€ã€‚
    
    ttlï¼ˆfloat æˆ–Noneï¼‰â€“å°†æ¡ç›®ä¿ç•™åœ¨ç¼“å­˜ä¸­çš„æœ€å¤§ç§’æ•°ï¼›å¦‚æœç¼“å­˜æ¡ç›®ä¸åº”è¿‡æœŸï¼Œåˆ™ä¸ºNoneã€‚é»˜è®¤ä¸ºæ— ã€‚
    ```
''')


st.write('''
    ## ç¤ºä¾‹1ï¼šåŸºæœ¬ç”¨æ³•
    é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºå…·æœ‰æ‰§è¡Œæ˜‚è´µçš„ï¼Œé•¿æ—¶é—´è¿è¡Œçš„è®¡ç®—çš„åŠŸèƒ½ã€‚å¦‚æœä¸è¿›è¡Œç¼“å­˜ï¼Œåˆ™æ¯æ¬¡åˆ·æ–°åº”ç”¨ç¨‹åºæ—¶éƒ½ä¼šé‡æ–°è¿è¡Œæ­¤åŠŸèƒ½ï¼Œä»è€Œå¯¼è‡´ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒã€‚
    * æˆ‘ä»¬æ·»åŠ äº†suppress_st_warningå…³é”®å­—åˆ°@ st.cacheè£…é¥°ã€‚
    * è¿™æ˜¯å› ä¸ºä¸Šé¢çš„ç¼“å­˜å‡½æ•°æœ¬èº«ä½¿ç”¨äº†Streamlitå‘½ä»¤ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºst.writeï¼‰ï¼Œå¹¶ä¸”å½“Streamlitçœ‹åˆ°è¯¥æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šæ˜¾ç¤ºä¸€æ¡è­¦å‘Šï¼ŒæŒ‡å‡ºä»…åœ¨å‘½ä¸­ç¼“å­˜å‘½ä¸­æ—¶å‘½ä»¤æ‰ä¼šæ‰§è¡Œã€‚
    * é€šå¸¸ï¼Œå½“æ‚¨çœ‹åˆ°è¯¥è­¦å‘Šæ—¶ï¼Œæ˜¯å› ä¸ºä»£ç ä¸­å­˜åœ¨é”™è¯¯ã€‚
    * ä½†æ˜¯ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨st.writeå‘½ä»¤æ¥æ¼”ç¤ºä½•æ—¶å‘½ä¸­ç¼“å­˜ï¼Œå› æ­¤Streamlitå‘æˆ‘ä»¬è­¦å‘Šçš„è¡Œä¸ºæ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚
    * ç»“æœï¼Œæˆ‘ä»¬ä¼ å…¥äº†suppress_st_warning = Trueæ¥å…³é—­è¯¥è­¦å‘Šã€‚
''')
# with st.echo():
#     @st.cache(suppress_st_warning=True)  # ğŸ‘ˆ Changed this
#     def expensive_computation(a, b):
#         # ğŸ‘‡ Added this
#         st.write("Cache miss: expensive_computation(", a, ",", b, ") ran")
#         time.sleep(2)  # This makes the function take 2s to run
#         return a * b

#     a = 2
#     b = 21
#     res = expensive_computation(a, b)

#     st.write("Result:", res)




st.write('''
    ## ç¤ºä¾‹2ï¼šå½“å‡½æ•°å‚æ•°æ›´æ”¹æ—¶
    åœ¨ä¸åœæ­¢å…ˆå‰çš„åº”ç”¨æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œè®©æˆ‘ä»¬å°†å…¶ä¸­ä¸€ä¸ªå‚æ•°æ›´æ”¹ä¸ºæˆ‘ä»¬çš„ç¼“å­˜å‡½æ•°ï¼š

    ç°åœ¨ï¼Œç¬¬ä¸€æ¬¡æ‚¨é‡æ–°è¿è¡Œè¯¥åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒæ˜¯ç¼“å­˜æœªå‘½ä¸­ã€‚è¿™å¯ä»¥é€šè¿‡æ˜¾ç¤ºâ€œ Cache missâ€ï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰æ–‡æœ¬ä»¥åŠåº”ç”¨ä»¥2ç§’çš„æ—¶é—´å®Œæˆè¿è¡Œæ¥è¯æ˜ã€‚
''')
# with st.echo():
#     @st.cache(suppress_st_warning=True)
#     def expensive_computation(a, b):
#         st.write("Cache miss: expensive_computation(", a, ",", b, ") ran")
#         time.sleep(2)  # This makes the function take 2s to run
#         return a * b

#     a = 2 
#     b = 210  # ğŸ‘ˆ Changed this
#     res = expensive_computation(a, b)

#     st.write("Result:", res)


st.write('''
    ## ç¤ºä¾‹3ï¼šå½“å‡½æ•°ä½“æ›´æ”¹æ—¶
    ç¬¬ä¸€æ¬¡è¿è¡Œæ˜¯â€œé«˜é€Ÿç¼“å­˜æœªå‘½ä¸­â€ï¼Œä½†æ˜¯å½“æ‚¨æŒ‰Ræ—¶ï¼Œæ¯ä¸ªåç»­è¿è¡Œéƒ½æ˜¯é«˜é€Ÿç¼“å­˜å‘½ä¸­ã€‚
''')
# with st.echo():
#     @st.cache(suppress_st_warning=True)
#     def expensive_computation(a, b):
#         st.write("Cache miss: expensive_computation(", a, ",", b, ") ran")
#         time.sleep(2)  # This makes the function take 2s to run
#         return a * b + 1  # ğŸ‘ˆ Added a +1 at the end here

#     a = 2
#     b = 210
#     res = expensive_computation(a, b)

#     st.write("Result:", res)




st.write('''
    ## ç¤ºä¾‹4ï¼šå†…éƒ¨å‡½æ•°å‘ç”Ÿå˜åŒ–æ—¶
    è®©æˆ‘ä»¬ä½¿ç¼“å­˜çš„å‡½æ•°åœ¨å†…éƒ¨ä¾èµ–äºå¦ä¸€ä¸ªå‡½æ•°

    æ‚¨æ‰€çœ‹åˆ°çš„æ˜¯é€šå¸¸çš„ï¼š
    * ç¬¬ä¸€æ¬¡è¿è¡Œä¼šå¯¼è‡´ç¼“å­˜æœªå‘½ä¸­ã€‚
    * éšåçš„æ¯ä¸ªé‡æ–°è¿è¡Œéƒ½ä¼šå¯¼è‡´ç¼“å­˜å‘½ä¸­ã€‚
''')
# with st.echo():
#     def inner_func(a, b):
#         st.write("inner_func(", a, ",", b, ") ran")
#         return a * b


#     @st.cache(suppress_st_warning=True)
#     def expensive_computation(a, b):
#         st.write("Cache miss: expensive_computation(", a, ",", b, ") ran")
#         time.sleep(2)  # This makes the function take 2s to run
#         return inner_func(a, b) + 1

#     a = 2
#     b = 210
#     res = expensive_computation(a, b)

#     st.write("Result:", res)

st.write('''
    * ç°åœ¨è®©æˆ‘ä»¬å°è¯•ä¿®æ”¹inner_func()
    * Streamlitå§‹ç»ˆä¼šéå†æ‚¨çš„ä»£ç åŠå…¶ä¾èµ–é¡¹ï¼Œä»¥éªŒè¯ç¼“å­˜çš„å€¼ä»ç„¶æœ‰æ•ˆã€‚
    * åœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨å¯ä»¥è‡ªç”±ç¼–è¾‘ä»£ç ï¼Œè€Œä¸å¿…æ‹…å¿ƒç¼“å­˜ã€‚
    * æ‚¨å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œçš„ä»»ä½•æ›´æ”¹ï¼ŒStreamlitéƒ½åº”è¯¥åšæ­£ç¡®çš„äº‹ï¼
    * Streamlitä¹Ÿè¶³å¤Ÿèªæ˜ï¼Œåªéœ€è¦éå†å±äºæ‚¨åº”ç”¨ç¨‹åºçš„ä¾èµ–é¡¹ï¼Œè€Œè·³è¿‡æ¥è‡ªå·²å®‰è£…çš„Pythonåº“çš„ä»»ä½•ä¾èµ–é¡¹ã€‚
''')
with st.echo():
    def inner_func(a, b):
        st.write("inner_func(", a, ",", b, ") ran")
        return a ** b  # ğŸ‘ˆ Changed the * to ** here

    @st.cache(suppress_st_warning=True)
    def expensive_computation(a, b):
        st.write("Cache miss: expensive_computation(", a, ",", b, ") ran")
        time.sleep(2)  # This makes the function take 2s to run
        return inner_func(a, b) + 1

    a = 2
    b = 21
    res = expensive_computation(a, b)

    st.write("Result:", res)